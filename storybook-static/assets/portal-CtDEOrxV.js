import{n as E,o as w,b,a as P,c as B,K as $,y as M,T as U,s as A,L as R}from"./use-sync-refs-Bp_oN-Mm.js";import{u as H}from"./keyboard-Dv8ekvWT.js";import{r as s,R as y}from"./index-BX3iQpgp.js";import{A as _,h as j}from"./focus-management-BOawEHzT.js";import{r as F}from"./index-DwCBTc21.js";import{l as X}from"./use-server-handoff-complete-ClNWh3JQ.js";let z=class extends Map{constructor(t){super(),this.factory=t}get(t){let n=super.get(t);return n===void 0&&(n=this.factory(t),this.set(t,n)),n}};function W(e,t){let n=e(),r=new Set;return{getSnapshot(){return n},subscribe(i){return r.add(i),()=>r.delete(i)},dispatch(i,...l){let u=t[i].call(n,...l);u&&(n=u,r.forEach(a=>a()))}}}function D(e){return s.useSyncExternalStore(e.subscribe,e.getSnapshot,e.getSnapshot)}let G=new z(()=>W(()=>[],{ADD(e){return this.includes(e)?this:[...this,e]},REMOVE(e){let t=this.indexOf(e);if(t===-1)return this;let n=this.slice();return n.splice(t,1),n}}));function O(e,t){let n=G.get(t),r=s.useId(),i=D(n);if(E(()=>{if(e)return n.dispatch("ADD",r),()=>n.dispatch("REMOVE",r)},[n,e]),!e)return!1;let l=i.indexOf(r),u=i.length;return l===-1&&(l=u,u+=1),l===u-1}let x=new Map,v=new Map;function S(e){var t;let n=(t=v.get(e))!=null?t:0;return v.set(e,n+1),n!==0?()=>C(e):(x.set(e,{"aria-hidden":e.getAttribute("aria-hidden"),inert:e.inert}),e.setAttribute("aria-hidden","true"),e.inert=!0,()=>C(e))}function C(e){var t;let n=(t=v.get(e))!=null?t:1;if(n===1?v.delete(e):v.set(e,n-1),n!==1)return;let r=x.get(e);r&&(r["aria-hidden"]===null?e.removeAttribute("aria-hidden"):e.setAttribute("aria-hidden",r["aria-hidden"]),e.inert=r.inert,x.delete(e))}function we(e,{allowed:t,disallowed:n}={}){let r=O(e,"inert-others");E(()=>{var i,l;if(!r)return;let u=w();for(let o of(i=n==null?void 0:n())!=null?i:[])o&&u.add(S(o));let a=(l=t==null?void 0:t())!=null?l:[];for(let o of a){if(!o)continue;let d=H(o);if(!d)continue;let c=o.parentElement;for(;c&&c!==d.body;){for(let f of c.children)a.some(h=>f.contains(h))||u.add(S(f));c=c.parentElement}}return u.dispose},[r,t,n])}function be(e,t,n){let r=b(i=>{let l=i.getBoundingClientRect();l.x===0&&l.y===0&&l.width===0&&l.height===0&&n()});s.useEffect(()=>{if(!e)return;let i=t===null?null:t instanceof HTMLElement?t:t.current;if(!i)return;let l=w();if(typeof ResizeObserver<"u"){let u=new ResizeObserver(()=>r.current(i));u.observe(i),l.add(()=>u.disconnect())}if(typeof IntersectionObserver<"u"){let u=new IntersectionObserver(()=>r.current(i));u.observe(i),l.add(()=>u.disconnect())}return()=>l.dispose()},[t,r,e])}function N(){return/iPhone/gi.test(window.navigator.platform)||/Mac/gi.test(window.navigator.platform)&&window.navigator.maxTouchPoints>0}function q(){return/Android/gi.test(window.navigator.userAgent)}function J(){return N()||q()}function g(e,t,n,r){let i=b(n);s.useEffect(()=>{if(!e)return;function l(u){i.current(u)}return document.addEventListener(t,l,r),()=>document.removeEventListener(t,l,r)},[e,t,r])}function K(e,t,n,r){let i=b(n);s.useEffect(()=>{if(!e)return;function l(u){i.current(u)}return window.addEventListener(t,l,r),()=>window.removeEventListener(t,l,r)},[e,t,r])}const T=30;function ye(e,t,n){let r=O(e,"outside-click"),i=b(n),l=s.useCallback(function(o,d){if(o.defaultPrevented)return;let c=d(o);if(c===null||!c.getRootNode().contains(c)||!c.isConnected)return;let f=function h(p){return typeof p=="function"?h(p()):Array.isArray(p)||p instanceof Set?p:[p]}(t);for(let h of f)if(h!==null&&(h.contains(c)||o.composed&&o.composedPath().includes(h)))return;return!_(c,j.Loose)&&c.tabIndex!==-1&&o.preventDefault(),i.current(o,c)},[i,t]),u=s.useRef(null);g(r,"pointerdown",o=>{var d,c;u.current=((c=(d=o.composedPath)==null?void 0:d.call(o))==null?void 0:c[0])||o.target},!0),g(r,"mousedown",o=>{var d,c;u.current=((c=(d=o.composedPath)==null?void 0:d.call(o))==null?void 0:c[0])||o.target},!0),g(r,"click",o=>{J()||u.current&&(l(o,()=>u.current),u.current=null)},!0);let a=s.useRef({x:0,y:0});g(r,"touchstart",o=>{a.current.x=o.touches[0].clientX,a.current.y=o.touches[0].clientY},!0),g(r,"touchend",o=>{let d={x:o.changedTouches[0].clientX,y:o.changedTouches[0].clientY};if(!(Math.abs(d.x-a.current.x)>=T||Math.abs(d.y-a.current.y)>=T))return l(o,()=>o.target instanceof HTMLElement?o.target:null)},!0),K(r,"blur",o=>l(o,()=>window.document.activeElement instanceof HTMLIFrameElement?window.document.activeElement:null),!0)}function I(...e){return s.useMemo(()=>H(...e),[...e])}function Q(){let e;return{before({doc:t}){var n;let r=t.documentElement,i=(n=t.defaultView)!=null?n:window;e=Math.max(0,i.innerWidth-r.clientWidth)},after({doc:t,d:n}){let r=t.documentElement,i=Math.max(0,r.clientWidth-r.offsetWidth),l=Math.max(0,e-i);n.style(r,"paddingRight",`${l}px`)}}}function Z(){return N()?{before({doc:e,d:t,meta:n}){function r(i){return n.containers.flatMap(l=>l()).some(l=>l.contains(i))}t.microTask(()=>{var i;if(window.getComputedStyle(e.documentElement).scrollBehavior!=="auto"){let a=w();a.style(e.documentElement,"scrollBehavior","auto"),t.add(()=>t.microTask(()=>a.dispose()))}let l=(i=window.scrollY)!=null?i:window.pageYOffset,u=null;t.addEventListener(e,"click",a=>{if(a.target instanceof HTMLElement)try{let o=a.target.closest("a");if(!o)return;let{hash:d}=new URL(o.href),c=e.querySelector(d);c&&!r(c)&&(u=c)}catch{}},!0),t.addEventListener(e,"touchstart",a=>{if(a.target instanceof HTMLElement)if(r(a.target)){let o=a.target;for(;o.parentElement&&r(o.parentElement);)o=o.parentElement;t.style(o,"overscrollBehavior","contain")}else t.style(a.target,"touchAction","none")}),t.addEventListener(e,"touchmove",a=>{if(a.target instanceof HTMLElement){if(a.target.tagName==="INPUT")return;if(r(a.target)){let o=a.target;for(;o.parentElement&&o.dataset.headlessuiPortal!==""&&!(o.scrollHeight>o.clientHeight||o.scrollWidth>o.clientWidth);)o=o.parentElement;o.dataset.headlessuiPortal===""&&a.preventDefault()}else a.preventDefault()}},{passive:!1}),t.add(()=>{var a;let o=(a=window.scrollY)!=null?a:window.pageYOffset;l!==o&&window.scrollTo(0,l),u&&u.isConnected&&(u.scrollIntoView({block:"nearest"}),u=null)})})}}:{}}function ee(){return{before({doc:e,d:t}){t.style(e.documentElement,"overflow","hidden")}}}function te(e){let t={};for(let n of e)Object.assign(t,n(t));return t}let m=W(()=>new Map,{PUSH(e,t){var n;let r=(n=this.get(e))!=null?n:{doc:e,count:0,d:w(),meta:new Set};return r.count++,r.meta.add(t),this.set(e,r),this},POP(e,t){let n=this.get(e);return n&&(n.count--,n.meta.delete(t)),this},SCROLL_PREVENT({doc:e,d:t,meta:n}){let r={doc:e,d:t,meta:te(n)},i=[Z(),Q(),ee()];i.forEach(({before:l})=>l==null?void 0:l(r)),i.forEach(({after:l})=>l==null?void 0:l(r))},SCROLL_ALLOW({d:e}){e.dispose()},TEARDOWN({doc:e}){this.delete(e)}});m.subscribe(()=>{let e=m.getSnapshot(),t=new Map;for(let[n]of e)t.set(n,n.documentElement.style.overflow);for(let n of e.values()){let r=t.get(n.doc)==="hidden",i=n.count!==0;(i&&!r||!i&&r)&&m.dispatch(n.count>0?"SCROLL_PREVENT":"SCROLL_ALLOW",n),n.count===0&&m.dispatch("TEARDOWN",n)}});function ne(e,t,n=()=>({containers:[]})){let r=D(m),i=t?r.get(t):void 0,l=i?i.count>0:!1;return E(()=>{if(!(!t||!e))return m.dispatch("PUSH",t,n),()=>m.dispatch("POP",t,n)},[e,t]),l}function Pe(e,t,n=()=>[document.body]){let r=O(e,"scroll-lock");ne(r,t,i=>{var l;return{containers:[...(l=i.containers)!=null?l:[],n]}})}function re(e){let t=P(e),n=s.useRef(!1);s.useEffect(()=>(n.current=!1,()=>{n.current=!0,B(()=>{n.current&&t()})}),[t])}let k=s.createContext(!1);function le(){return s.useContext(k)}function xe(e){return y.createElement(k.Provider,{value:e.force},e.children)}function oe(e){let t=le(),n=s.useContext(Y),r=I(e),[i,l]=s.useState(()=>{var u;if(!t&&n!==null)return(u=n.current)!=null?u:null;if(A.isServer)return null;let a=r==null?void 0:r.getElementById("headlessui-portal-root");if(a)return a;if(r===null)return null;let o=r.createElement("div");return o.setAttribute("id","headlessui-portal-root"),r.body.appendChild(o)});return s.useEffect(()=>{i!==null&&(r!=null&&r.body.contains(i)||r==null||r.body.appendChild(i))},[i,r]),s.useEffect(()=>{t||n!==null&&l(n.current)},[n,l,t]),i}let V=s.Fragment,ie=$(function(e,t){let n=e,r=s.useRef(null),i=M(U(f=>{r.current=f}),t),l=I(r),u=oe(r),[a]=s.useState(()=>{var f;return A.isServer?null:(f=l==null?void 0:l.createElement("div"))!=null?f:null}),o=s.useContext(L),d=X();E(()=>{!u||!a||u.contains(a)||(a.setAttribute("data-headlessui-portal",""),u.appendChild(a))},[u,a]),E(()=>{if(a&&o)return o.register(a)},[o,a]),re(()=>{var f;!u||!a||(a instanceof Node&&u.contains(a)&&u.removeChild(a),u.childNodes.length<=0&&((f=u.parentElement)==null||f.removeChild(u)))});let c=R();return d?!u||!a?null:F.createPortal(c({ourProps:{ref:i},theirProps:n,slot:{},defaultTag:V,name:"Portal"}),a):null});function ue(e,t){let n=M(t),{enabled:r=!0,...i}=e,l=R();return r?y.createElement(ie,{...i,ref:n}):l({ourProps:{ref:n},theirProps:i,slot:{},defaultTag:V,name:"Portal"})}let ae=s.Fragment,Y=s.createContext(null);function se(e,t){let{target:n,...r}=e,i={ref:M(t)},l=R();return y.createElement(Y.Provider,{value:n},l({ourProps:i,theirProps:r,defaultTag:ae,name:"Popover.Group"}))}let L=s.createContext(null);function Le(){let e=s.useContext(L),t=s.useRef([]),n=P(l=>(t.current.push(l),e&&e.register(l),()=>r(l))),r=P(l=>{let u=t.current.indexOf(l);u!==-1&&t.current.splice(u,1),e&&e.unregister(l)}),i=s.useMemo(()=>({register:n,unregister:r,portals:t}),[n,r,t]);return[t,s.useMemo(()=>function({children:l}){return y.createElement(L.Provider,{value:i},l)},[i])]}let ce=$(ue),de=$(se),$e=Object.assign(ce,{Group:de});export{ye as R,de as X,re as c,Pe as f,xe as l,be as m,I as n,$e as r,K as s,Le as t,O as x,we as y};
